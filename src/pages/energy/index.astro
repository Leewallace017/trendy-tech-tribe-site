---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('energy')).sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---

<BaseLayout
  title="Energy & Policy"
  description="Clean energy technology, grid infrastructure, energy storage, tech policy, regulation, and commentary on energy and climate topics."
>
  <Header />

  <main>
    <div class="container">
      <header class="category-header">
        <h1>Energy & Policy</h1>
        <p class="category-description">
          Clean energy, grid technology, storage solutions, and tech-related policy, regulation, and opinion.
        </p>
      </header>

      <div class="posts-list">
        {posts.map(post => (
          <article class="post-item">
            <time datetime={post.data.date} class="post-date">
              {new Date(post.data.date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              })}
            </time>
            <h2>
              <a href={`/energy/${post.data.slug}`}>{post.data.title}</a>
            </h2>
            <p class="post-summary">{post.data.summary}</p>
            <div class="post-meta">
              <span class="post-type">{post.data.type}</span>
              {post.data.tags.length > 0 && (
                <div class="post-tags">
                  {post.data.tags.slice(0, 3).map(tag => (
                    <span class="tag">{tag}</span>
                  ))}
                </div>
              )}
            </div>
          </article>
        ))}
      </div>
    </div>
  </main>

  <Footer />
</BaseLayout>

<style>
  .category-header {
    padding: var(--space-2xl) 0 var(--space-xl);
    border-bottom: 3px solid var(--color-primary);
    margin-bottom: var(--space-xl);
  }

  .category-header h1 {
    font-size: 3rem;
    margin-bottom: var(--space-md);
  }

  .category-description {
    font-size: 1.25rem;
    color: var(--color-text-light);
    max-width: 800px;
  }

  .posts-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-xl);
    margin-bottom: var(--space-2xl);
  }

  .post-item {
    padding-bottom: var(--space-xl);
    border-bottom: 1px solid var(--color-border);
  }

  .post-date {
    display: block;
    font-size: 0.875rem;
    color: var(--color-text-light);
    margin-bottom: var(--space-sm);
  }

  .post-item h2 {
    font-size: 2rem;
    margin-bottom: var(--space-sm);
    line-height: 1.3;
  }

  .post-item h2 a {
    color: var(--color-text);
    transition: color 0.2s;
  }

  .post-item h2 a:hover {
    color: var(--color-primary);
  }

  .post-summary {
    font-size: 1.125rem;
    color: var(--color-text-light);
    line-height: 1.6;
    margin-bottom: var(--space-md);
  }

  .post-meta {
    display: flex;
    align-items: center;
    gap: var(--space-md);
  }

  .post-type {
    background-color: var(--color-bg-alt);
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    font-size: 0.875rem;
    color: var(--color-text-light);
    text-transform: capitalize;
  }

  .post-tags {
    display: flex;
    gap: var(--space-xs);
  }

  .tag {
    font-size: 0.875rem;
    color: var(--color-text-light);
  }

  .tag::before {
    content: "#";
  }

  @media (max-width: 768px) {
    .category-header h1 {
      font-size: 2rem;
    }

    .category-description {
      font-size: 1rem;
    }

    .post-item h2 {
      font-size: 1.5rem;
    }

    .post-summary {
      font-size: 1rem;
    }
  }
</style>
